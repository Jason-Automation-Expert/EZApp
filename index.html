// Function to format date as MM/DD/YYYY
function formatDate(dateInput) {
    const date = new Date(dateInput.value);
    if (!isNaN(date.getTime())) {
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        const year = date.getFullYear();
        return `${month}/${day}/${year}`;
    }
    return '';
}

// Handle form submission
document.getElementById('applicationForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Create FormData object
    const formData = new FormData(this);
    
    // Format all date inputs and update FormData
    const dateInputs = document.querySelectorAll('.date-input');
    dateInputs.forEach(input => {
        if (input.value) {
            const formattedDate = formatDate(input);
            formData.set(input.name, formattedDate);
        }
    });
    
    // Convert FormData to URL-encoded string
    const data = new URLSearchParams(formData);
    
    // Submit the form using fetch
    fetch(this.action, {
        method: 'POST',
        body: data,
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
        }
    })
    .then(response => response.json())
    .then(data => console.log('Success:', data))
    .catch(error => console.error('Error:', error));
});

// Format phone number as user types
const phoneInput = document.querySelector('input[name="phone"]');
if (phoneInput) {
    phoneInput.addEventListener('input', function(e) {
        let x = e.target.value.replace(/\D/g, '').match(/(\d{0,3})(\d{0,3})(\d{0,4})/);
        e.target.value = !x[2] ? x[1] : `(${x[1]}) ${x[2]}${x[3] ? '-' + x[3] : ''}`;
    });
}

// Format SSN as user types
const ssnInput = document.querySelector('input[name="ssn"]');
if (ssnInput) {
    ssnInput.addEventListener('input', function(e) {
        let x = e.target.value.replace(/\D/g, '').match(/(\d{0,3})(\d{0,2})(\d{0,4})/);
        e.target.value = !x[2] ? x[1] : `${x[1]}-${x[2]}${x[3] ? '-' + x[3] : ''}`;
    });
}
